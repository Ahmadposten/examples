## How to set up Artifactory Enterprise on DC/OS

[Artifactory Enterprise](https://www.jfrog.com/artifactory/versions/#High-Availability) is a highly available installation of Artifactory. It does this by using a load balancer that balances requests across multiple Artifactory instances.

![Artifactory Enterprise Architecture](img/HA_Diagram.png)

## Prerequisites

- DC/OS 1.8 or later with at least one public agent
- [DC/OS CLI installed](https://dcos.io/docs/1.8/usage/cli/install/) and configured to use your cluster
- Database (MySQL, Oracle, MS SQL Server or Postgres)
- Artifactory Enterprise license
- NFS directory mounted to each node

## Setting up Artifactory Enterprise

1. Mount NFS Storage to Each Private Node of DC/OS Cluster.<br />
    For example: You have artifactoryha.mount.com:/artifactory as your mount point.
    Mount it to /var/data/artha dir of your each private node of DC/OS.
      ```sudo mount artifactoryha.mount.com:/artifactory /var/artifactory/```
    All the nodes should share the same file storage, for now the only way is to use NFS. This requirement will be removed in the future.<br />
    Note: Provide permission to write and create subdirectories to /var/data/artha.

2. Create a new file called `artifactory-enterprise-options.json`, with the following content (replace the license parameter with your own license string):

```
{
  "service": {
    "name": "artifactory",
    "cpus": 2,
    "mem": 2048,
    "licenses": "$ARTIFACTORY_ENTERPRISE_LICENSES",
    "host-volume": "/var/artifactory",
    "database": {
      "connection-string": "jdbc:mysql://mysql.marathon.mesos:3306/artdb?characterEncoding=UTF-8&elideSetAutoCommits=true",
      "user": "jfrogdcos",
      "password": "jfrogdcos"
    }
  },
  "pro": {
    "local-volumes": {},
    "external-volumes": {
      "enabled": false
    }
  },
  "high-availability": {
    "enabled": true,
    "secondary": {
      "enabled": false,
      "unique-nodes": true,
      "nodes": 1,
      "name": "artifactory"
    }
  }
}
```

 ###NOTE: Make sure database name, is correct in connection-string as well as username & password for database.
 ### Licenses: Provide all Artifactory Licenses as a single string comma separated without white spaces in string.

   ### NOTE: API Key of Artifactory generated by Artifactory-Primary to fetch license from Artifactory-Primary (Optional)

3. Run the following DC/OS CLI command to install Artifactory Enterprise:

```
dcos package install --options=artifactory-primary-options.json artifactory
```

### Install Artifactory-lb

Once Artifactory is up and running, [follow this guide to set up Artifactory-lb](artifactory-lb.md).

### Scaling Artifactory Enterprise

TODO: instructions on how to add nodes
