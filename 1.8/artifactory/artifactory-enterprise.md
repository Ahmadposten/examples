## How to set up Artifactory Enterprise on DC/OS

[Artifactory Enterprise](https://www.jfrog.com/artifactory/versions/#High-Availability) is a highly available installation of Artifactory. It does this by using a load balancer to balance requests across multiple Artifactory instances.

![Artifactory Enterprise Architecture](img/HA_Diagram.png)

## Prerequisites

- DC/OS 1.8 or later with at least one public agent
- [DC/OS CLI installed](https://dcos.io/docs/1.8/usage/cli/install/) and configured to use your cluster
- Database (MySQL, Oracle, MS SQL Server or Postgres)
- Artifactory Enterprise license
- NFS directory mounted to each node

## Setting up Artifactory Enterprise

### 1. Mount NFS Storage to Each Private Node of DC/OS Cluster
All nodes should share the same file storage. For now, the only supported method is with NFS, but this requirement will be removed in the future.

As an example, if `artifactoryha.mount.com:/artifactory` is the mount point, mount it to `/var/data/artha` on each private node of DC/OS with the following command:

```
sudo mount artifactoryha.mount.com:/artifactory /var/artifactory/
```

#### NOTE: Provide permission to write and create subdirectories to `/var/data/artha`.

### 2. Installation Options File

Create a new file, called `artifactory-enterprise-options.json`, with the content below. 

Be sure to:

- replace `service.license` with your own license string, separating multiple licenses with a comma (`,`) and no additional whitespace
- replace `service.database.user` and `service.database.password` with the correct values
- replace `DATABASE_NAME` within `service.database.connection-string` with the correct database name

```
{
  "service": {
    "name": "artifactory",
    "cpus": 2,
    "mem": 2048,
    "licenses": "$ARTIFACTORY_ENTERPRISE_LICENSES",
    "host-volume": "/var/artifactory",
    "database": {
      "connection-string": "jdbc:mysql://mysql.marathon.mesos:3306/DATABASE_NAME?characterEncoding=UTF-8&elideSetAutoCommits=true",
      "user": "jfrogdcos",
      "password": "jfrogdcos"
    }
  },
  "pro": {
    "local-volumes": {},
    "external-volumes": {
      "enabled": false
    }
  },
  "high-availability": {
    "enabled": true,
    "secondary": {
      "enabled": false,
      "unique-nodes": true,
      "nodes": 1,
      "name": "artifactory"
    }
  }
}
```

#### NOTE: (Optional) API Key of Artifactory generated by Artifactory-Primary to fetch license from Artifactory-Primary

### 3. Install Artifactory Enterprise through DC/OS CLI

Run the following DC/OS CLI command to install Artifactory Enterprise:

```
dcos package install --options=artifactory-primary-options.json artifactory
```

## Install Artifactory-lb

Once Artifactory is up and running, [follow this guide to set up Artifactory-lb](artifactory-lb.md).

## Scaling Artifactory Enterprise

TODO: instructions on how to add nodes
